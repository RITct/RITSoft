<?php

include("includes/header.php");
include("includes/sidenav.php");
include("includes/connection.php");
?>


      

                

                

                <!-- /side nav -->
<?php //include("../includes/sidenav.php");?>
<div id="page-wrapper">
    <div class="row">
        <div class="col-lg-12">
            <h1 class="page-header"><span style="font-weight:bold;">      



            </span></h1>
        </div>
        <!-- /.col-lg-12 -->
    </div>

    <!-- /.row -->
    <div class="row">
        <div class="col-lg-12 col-md-12">
            <div class="panel panel-green">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-xs-3">
                            <i class="fa fa-table fa-fw fa-2x"></i>
                        </div>
                        <div class="col-xs-9 text-right">
                            <div class="huge">
                                    
                            </div>
                            <div>Registered Scholarships </div>
                        </div>
                    </div>
                </div>
				<div class="panel-body">
				<form action="" id="searchform" method="POST">
				<div class="form-row"   >
					
					<div class="form-inline row" style="width:100%">
						
						<div class="form-group col-sm-6  col-lg-6 agileits-w3layouts">		
							<?php if (isset($_POST["stype"])){$sty=$_POST["stype"];}else{$sty="";}?>		
							<input type="radio" id="rb0" name="stype" checked  value="all"/>View All							
							<input type="radio" id="rb1" name="stype" <?php if($sty=="student"){echo "checked";}?> value="student"/>Search by Student
							<input type="radio" id="rb2" name="stype"  <?php if($sty=="branch"){echo "checked";}?> value="branch"/>Search by Branch
						</div>
						
					</div>
				</div>
				
				<div class="form-row" id="divBranch" <?php if($sty=="branch"){echo 'style="display:block"';}else{echo 'style="display:none"';}?>   >
					
					<div class="form-inline row" style="width:100%">
						
						<div class="form-group col-sm-6  col-lg-4 agileits-w3layouts">							
							<?php
							//include_once("../connection.php");
							$qr1="select distinct deptname from class_details";
							$res1=mysql_query($con,$qr1);
							
								?>
								<label for="inputPassword" class="control-label">Department</label>	
							<select name="dept" class="form-control" id="dept">
								<option value="">Select</option>
								<?php while($dep=mysql_fetch_array($res1)){?>
								<option value="<?=$dep['deptname'];?>"><?=$dep['deptname'];?></option>
								<?php }?>
								
							</select>
						</div>
						<div class="form-group col-sm-6 col-lg-2 agileits-w3layouts">							
							<?php
							
								?>
								<label for="inputPassword" class="control-label">Course</label>	<br/>
							<select name="course" class="form-control" id="course">
								<option value="">Select Department</option>
								
							</select>
						</div>
						<div class="form-group col-sm-6  col-lg-4 agileits-w3layouts">							
							<?php
							
								?>
								<label for="inputPassword" class="control-label">Specialization</label>	<br/>
							<select name="special" class="form-control" id="special">
								<option value="">Select Course</option>
								
							</select>
						</div>
						<div class="form-group col-sm-6 col-lg-1  col-xs-4 w3-agile">
						<label for="inputPassword" class="control-label">&nbsp;</label>	<br/>
							<input type="submit" value="Search" class="btn btn-success form-control" name="search"/>
						</div>
					</div>
				</div>
				<div class="form-row" id="divStudent"  <?php if($sty=="student"){echo 'style="display:block"';}else{echo 'style="display:none"';}?>  >
					
					<div class="form-inline row" style="width:100%">
						
						<div class="form-group col-sm-6  col-lg-4 agileits-w3layouts">	
							<label for="inputPassword" class="control-label">Adminssion NO</label>						
							<input type="text" class="form-control"name="sregno" <?php if(isset($_POST['sregno'])){ echo 'value="'.$_POST['sregno'].'"';}?> />
						</div>
						
						<div class="form-group col-sm-6 col-lg-1  col-xs-4 w3-agile">
						
							<input type="submit" value="Search" class="btn btn-success form-control" name="search"/>
						</div>
					</div>
				</div>
				
				</form>
				<div>&nbsp;</div>
				
				<?php
				//include_once("../connection.php");
				$part="";
				 $qr2="select sc.*,st.name,st.courseid,st.branch_or_specialisation from scholarship as sc,stud_details as st where sc.schol_student=st.admissionno  ";
				if(isset($_POST["search"])){
					extract($_POST);
					if($stype=="branch")
					{
					if(($_POST["dept"]=="")&&($_POST["course"]=="")&&($_POST["special"]=="")){$qr2=$qr2;}
					else{
						$p1=$p2=$p3="";
						if($_POST["dept"]!=""){$p1="and cd.deptname='$dept'";}
						if($_POST["course"]!=""){$p2="and cd.courseid='$course'";}
						if($_POST["special"]!=""){$p3="and cd.branch_or_specialisation='$special'";}
					
					$qr2="select sc.*,st.name,st.branch_or_specialisation,st.courseid from scholarship as sc,stud_details as st,current_class as cc, class_details as cd where sc.schol_student=st.admissionno and sc.schol_student=cc.studid and cc.classid=cd.classid $p1 $p2 $p3 "; 
					}
					}else if($stype=="student"){
						$sq="select * from stud_details where admissionno='$sregno'";
						$qr2="select sc.*,st.name,st.branch_or_specialisation,st.courseid from scholarship as sc,stud_details as st,current_class as cc, class_details as cd where sc.schol_student=st.admissionno and sc.schol_student=cc.studid and cc.classid=cd.classid and sc.schol_student='$sregno' ";
					}
					
				}
					
					?>
				<form action="" method="POST">
				
				<div class="form-row"   >
					<h3 align="center">Scholarship Applications</h3>						
				</div>
				
				<div class="form-row"   >
				<h4>
				<?Php $head=""; if(isset($_POST['search'])){
					if($_POST['stype']=="branch")
					{
					if($_POST["dept"]!=""){$head.="Department : ".$_POST["dept"]."&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";}
					if($_POST["course"]!=""){$head.= "<br/><br/> Course : ".$_POST["course"]."&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";}
					if($_POST["special"]!=""){$head.= "<br/><br/>Specialization : ".$_POST["special"];}
					}else{
						$sres2=mysql_query($con,$sq)or die(mysql_error($con));
						if(mysql_num_rows($sres2)>0)
						{
						$sdata=mysql_fetch_array($sres2);
						
						$head.="Adminssion No : ".$sdata['admissionno']."&nbsp;&nbsp;<br/><br/>Name : ".$sdata['name']."&nbsp;&nbsp;<br/><br/>Course : ".$sdata['courseid']."&nbsp;&nbsp;<br/><br/>Specialization : ".$sdata['branch_or_specialisation'];
						}else{
							$head='<div class="alert alert-danger"> Student Record Not found!...</div>';
						}
					}
					echo $head;
				}?>			
				</h4>				
				</div>
				<?php
				$apps=1;
				$res2=mysql_query($con,$qr2)or die(mysql_error($con));
				if(mysql_num_rows($res2)==0)
				{ $apps=0;
					?>
					<div class="alert alert-danger"> No  Applications found!...</div>
					<?php
				}else{
					?>
					<table class="table bg-success table-bordered">
					<tr>
						<td> <b>Sl No</b></td>
						<td><b>Student</b> </td>
						<td><b>Course</b></td>
						<td><b>Scholarship</b></td>
						<td><b>Category</b></td>
						<td><b>Semester</b></td>
						<td><b>Date</b></td>
						<td><b>Status</b></td>
						<td><b>Action</b></td>
					</tr>
					<?php $i=1; while($adata=mysql_fetch_array($res2))
					{
						?>
						<tr>
							<td> <?=$i++;?></td>
							<td><?=$adata['schol_student'];?>-<?=$adata['name'];?></td>
							<td><?=$adata['courseid']."-".$adata['branch_or_specialisation'];?></td>
							<td><?=$adata['schol_type'];?></td>
							<td><?=$adata['category'];?></td>
							<td align="center"><?=$adata['semester'];?></td>
							<td><?php echo date("d/m/Y", strtotime($adata['schol_date']));?></td>
							<td align="center"><?=$adata['schol_status'];?></td>
							<td align="center"><?php 
								if($adata['schol_status']=="Approved")
									{?><a href='changestatus.php?id=<?=$adata["schol_id"]?>&&st=cancel' onclick="return confirm('Are you sure to Cancel this application?')">Cancel</a><?php }
								else if($adata['schol_status']=="Cancelled")
									{?><a href='changestatus.php?id=<?=$adata["schol_id"]?>&&st=approve' onclick="return confirm('Are you sure to Approve this application?')">Approve</a><?php }
							?>								
							</td>
						</tr>
						<?php
					}
					?>
					</table>
					<?php
					
				}?>
				
	
				</form>
				<div class="row">
				<?php if($apps!=0){?>
				<div class="col-md-6 col-lg-6">
				<?php if(($sty!="student")&&($sty!="branch")){?>
				<form action="generateexcell.php" method="POST">
	
				<div class="form-row"   >
					
					<div class="form-inline row" style="width:100%">
						
						<div class="form-group col-sm-6  col-lg-4 agileits-w3layouts">							
							
							<input type="hidden" name="query" value="<?=$qr2;?>"/>
							<input type="hidden" name="head" value="<?=$head;?>"/>
							<input type="submit" value="Generate Excell" class="btn btn-primary form-control" name="Excell"/>
						</div>
					</div>
				</div>
				</form>
				<?php }?>
				</div>
				<div class="col-md-6 col-lg-6">
				
				<form action="generatepdf.php" method="POST">
	
					<div class="form-row"   >
						
						<div class="form-inline row" style="width:100%">
							
							<div class="form-group col-sm-12  col-lg-12 agileits-w3layouts">	
								<input type="hidden" name="query" value="<?=$qr2;?>"/>
								<input type="hidden" name="head" value="<?=$head;?>"/>
								<input type="submit" value="Generate PDF" class="btn btn-danger form-control" name="Print"/>
							</div>
						</div>
					</div>
				</form>
				
				</div>
				<?php }?>
				</div>
				</div>
                <div class="panel-footer">
                    
                <div class="clearfix"></div>
                </div>
                </a>
            </div>
        </div>


        <!-- /.row -->
        
        <!-- /.panel -->

        <!-- /.panel-body -->

        <!-- /.panel-footer -->
    </div>
    <!-- /.panel .chat-panel -->
</div>

<?php include("../includes/footer.php");?>
<script>
	$(document).ready(function(){
		
		$("#dept").on("change",function(){
			pn=$("#dept").val();
			var choose = "<option value=''>Select Department</option>";
			$("#course").html(choose);
			choose = "<option value=''>Select Course</option>";
			$("#special").html(choose);
			$.ajax({
			url : "ajax.php",
			method : "POST",
			data : {loadCourse:1,dep:pn},
			success : function(data){
				var choose = "<option value=''>Choose Course</option>";
				$("#course").html(choose+data);
				}
			})
		});
		$("#course").on("change",function(){
			dp=$("#dept").val();
			pn=$("#course").val();
			
			$.ajax({
			url : "ajax.php",
			method : "POST",
			data : {loadSpecial:1,dep:dp,cr:pn},
			success : function(data){
				var choose = "<option value=''>Choose Specialization</option>";
				$("#special").html(choose+data);
				}
			})
		});
		 $('#rb0,#rb1,#rb2').change(function () {
                var selectedVal = $(this).val();
				if(selectedVal=='student')
				{
					$('#divBranch').hide();
					$('#divStudent').show();
				}else if(selectedVal=='branch'){
					$('#divStudent').hide();
					$('#divBranch').show();
				}else if(selectedVal=='all'){
					$('#divStudent').hide();
					$('#divBranch').hide();
					$('#searchform').submit();
				}
                         // alert($(this).val());
            });
	});
	</script>